<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì‹œê¸‰ 2ë°° ì±Œë¦°ì§€ â€” ì°¸ì—¬ì ì„¤ë¬¸</title>
<link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
<style>
:root {
  --yellow: #FCD20B;
  --yellow-10: rgba(252,210,11,0.10);
  --yellow-15: rgba(252,210,11,0.15);
  --yellow-25: rgba(252,210,11,0.25);
  --yellow-50: rgba(252,210,11,0.50);
  --brown: #452614;
  --brown-80: rgba(69,38,20,0.80);
  --brown-60: rgba(69,38,20,0.60);
  --brown-40: rgba(69,38,20,0.40);
  --brown-20: rgba(69,38,20,0.20);
  --brown-10: rgba(69,38,20,0.10);
  --brown-06: rgba(69,38,20,0.06);
  --brown-04: rgba(69,38,20,0.04);
  --brown-03: rgba(69,38,20,0.03);
  --bg: #F7F6F3;
  --card: #FFFFFF;
  --error: #E53935;
  --error-bg: rgba(229,57,53,0.06);
  --success: #2E7D32;
  --success-bg: rgba(46,125,50,0.06);
  --r: 16px;
  --rs: 12px;
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{font-size:16px}
body{
  font-family:'Pretendard Variable',Pretendard,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);color:var(--brown);min-height:100dvh;
  -webkit-font-smoothing:antialiased;overscroll-behavior:none;
}

/* â”€â”€â”€ Progress â”€â”€â”€ */
.prog-wrap{position:fixed;top:0;left:0;right:0;height:2px;background:var(--brown-06);z-index:100}
.prog-fill{height:100%;background:var(--yellow);transition:width 1s cubic-bezier(.25,1,.5,1);width:0%}

/* â”€â”€â”€ Layout â”€â”€â”€ */
.wrap{max-width:440px;margin:0 auto;padding:24px 20px 140px;min-height:100dvh}

/* â”€â”€â”€ Step â”€â”€â”€ */
.step{display:none}
.step.active{display:block;animation:fadeUp .4s cubic-bezier(.16,1,.3,1)}
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€â”€ Card â”€â”€â”€ */
.card{
  background:var(--card);border-radius:var(--r);padding:32px 24px;
  box-shadow:0 1px 3px rgba(69,38,20,0.04),0 4px 16px rgba(69,38,20,0.02);
  border:1px solid var(--brown-06);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTRO
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.intro-tag{
  display:inline-flex;align-items:center;gap:4px;
  background:var(--yellow-15);color:var(--brown);
  font-size:12px;font-weight:700;padding:5px 12px;border-radius:20px;margin-bottom:24px;
}
.intro-card{margin-top:0;text-align:center}
.intro-icon{font-size:36px;margin-bottom:20px;display:block}
.intro-title{
  font-size:22px;font-weight:800;line-height:1.45;letter-spacing:-0.04em;margin-bottom:16px;
}
.intro-title em{font-style:normal;color:var(--brown)}
.intro-desc{font-size:14px;color:var(--brown-80);line-height:1.8;margin-bottom:28px;word-break:keep-all}
.intro-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:28px}
.intro-grid-item{
  background:var(--brown-03);border-radius:var(--rs);padding:16px;text-align:center;
}
.intro-grid-label{font-size:11px;color:var(--brown-60);font-weight:600;letter-spacing:.03em;margin-bottom:5px}
.intro-grid-val{font-size:18px;font-weight:800;color:var(--brown)}
.intro-tip{
  background:var(--yellow-10);border-radius:var(--rs);padding:14px 16px;
  font-size:13px;color:var(--brown-80);line-height:1.7;word-break:keep-all;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PHONE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ph-title{font-size:18px;font-weight:800;margin-bottom:6px;letter-spacing:-0.03em}
.ph-sub{font-size:13px;color:var(--brown-60);font-weight:400;margin-bottom:0}
.ph-gap{height:36px}
.ph-row{display:flex;align-items:center;gap:10px}
.ph-input{
  flex:1;text-align:center;width:0;
  font-family:'Pretendard Variable',sans-serif;font-size:18px;font-weight:700;letter-spacing:.08em;
  padding:13px 4px;border:1.5px solid var(--brown-10);border-radius:var(--rs);outline:none;
  transition:all .25s ease;background:var(--brown-03);color:var(--brown);
}
.ph-input::placeholder{color:var(--brown-20);font-weight:500}
.ph-input:focus{border-color:var(--yellow);background:var(--card);box-shadow:0 0 0 3px var(--yellow-25)}
.ph-input.ok{border-color:var(--yellow);background:var(--yellow-10)}
.ph-input.bad{border-color:var(--error);background:var(--error-bg)}
.ph-dash{font-size:18px;color:var(--brown-20);font-weight:300;flex-shrink:0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUESTION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.q-num{font-size:12px;font-weight:700;color:var(--brown-60);letter-spacing:.04em;margin-bottom:16px}
.q-text{font-size:17px;font-weight:700;line-height:1.6;letter-spacing:-0.025em;word-break:keep-all;color:var(--brown)}
.q-hint{font-size:13px;color:var(--brown-60);margin-top:6px;font-weight:400}
.q-multi{
  display:inline-flex;align-items:center;gap:4px;
  background:var(--yellow-10);color:var(--brown-80);
  font-size:11px;font-weight:700;padding:4px 10px;border-radius:8px;margin-top:10px;
}
.q-gap{height:36px}

/* â”€â”€â”€ Options (í† ìŠ¤ ìŠ¤íƒ€ì¼: ì„ íƒ ì „ ìµœëŒ€í•œ ë®¤íŠ¸) â”€â”€â”€ */
.opts{display:flex;flex-direction:column;gap:10px}
.opt{position:relative;cursor:pointer}
.opt input{position:absolute;opacity:0;pointer-events:none}
.opt-label{
  display:flex;align-items:center;gap:14px;padding:18px 16px;
  border:1.5px solid var(--brown-06);border-radius:var(--rs);
  font-size:15px;font-weight:400;line-height:1.5;color:var(--brown);
  transition:all .2s ease;word-break:keep-all;user-select:none;-webkit-user-select:none;
  background:var(--card);
}
.opt-label:active{transform:scale(.985)}

/* ì„ íƒ ì‹œ */
.opt input:checked+.opt-label{
  border-color:var(--yellow);background:var(--yellow-10);
  color:var(--brown);font-weight:600;
  box-shadow:0 0 0 1px var(--yellow-50);
}

/* ì¸ë””ì¼€ì´í„° */
.ind{
  flex-shrink:0;width:22px;height:22px;border-radius:50%;
  border:1.5px solid var(--brown-10);background:var(--brown-03);
  display:flex;align-items:center;justify-content:center;transition:all .2s ease;
}
.ind.chk{border-radius:6px}
.opt input:checked+.opt-label .ind{
  border-color:var(--yellow);background:var(--yellow);
  box-shadow:0 1px 4px rgba(252,210,11,0.3);
}
.opt input:checked+.opt-label .ind::after{content:'';display:block}
.opt input[type="radio"]:checked+.opt-label .ind::after{
  width:8px;height:8px;border-radius:50%;background:var(--brown);
}
.opt input[type="checkbox"]:checked+.opt-label .ind::after{
  width:12px;height:12px;
  background:url("data:image/svg+xml,%3Csvg viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.5 6L5 8.5L9.5 3.5' stroke='%23452614' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") center/contain no-repeat;
}

/* â”€â”€â”€ Etc â”€â”€â”€ */
.etc-wrap{display:none;margin-top:8px;animation:fadeUp .25s ease}
.etc-wrap.show{display:block}
.etc-ta{
  width:100%;padding:14px 16px;border:1.5px solid var(--brown-06);border-radius:var(--rs);
  font-family:'Pretendard Variable',sans-serif;font-size:14px;resize:none;outline:none;
  transition:all .2s ease;min-height:76px;background:var(--brown-03);color:var(--brown);line-height:1.6;
}
.etc-ta::placeholder{color:var(--brown-20)}
.etc-ta:focus{border-color:var(--yellow);background:var(--card);box-shadow:0 0 0 3px var(--yellow-25)}

/* â”€â”€â”€ Likert â”€â”€â”€ */
.likert{display:flex;flex-direction:column;gap:10px}
.lik{position:relative;cursor:pointer}
.lik input{position:absolute;opacity:0;pointer-events:none}
.lik-label{
  display:flex;align-items:center;gap:14px;padding:16px;
  border:1.5px solid var(--brown-06);border-radius:var(--rs);
  font-size:15px;color:var(--brown);background:var(--card);
  transition:all .2s ease;user-select:none;
}
.lik-label:active{transform:scale(.985)}
.lik input:checked+.lik-label{
  border-color:var(--yellow);background:var(--yellow-10);
  color:var(--brown);font-weight:600;box-shadow:0 0 0 1px var(--yellow-50);
}
.lik-emoji{font-size:20px;flex-shrink:0}

/* â”€â”€â”€ Free text â”€â”€â”€ */
.free-ta{
  width:100%;padding:16px;border:1.5px solid var(--brown-06);border-radius:var(--rs);
  font-family:'Pretendard Variable',sans-serif;font-size:15px;resize:none;outline:none;
  transition:all .2s ease;min-height:120px;line-height:1.7;background:var(--brown-03);color:var(--brown);
}
.free-ta::placeholder{color:var(--brown-20)}
.free-ta:focus{border-color:var(--yellow);background:var(--card);box-shadow:0 0 0 3px var(--yellow-25)}

/* â”€â”€â”€ Highlight (í˜•ê´‘íœ) â”€â”€â”€ */
.hl{background:linear-gradient(transparent 55%,var(--yellow-25) 55%,var(--yellow-25) 90%,transparent 90%);padding:0 2px;font-weight:700}

/* â”€â”€â”€ Validation â”€â”€â”€ */
.val-msg{
  display:none;align-items:center;gap:6px;margin-top:20px;padding:12px 14px;
  background:var(--error-bg);border-radius:10px;font-size:13px;color:var(--error);font-weight:600;
  animation:shake .35s ease;
}
.val-msg.show{display:flex}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-5px)}60%{transform:translateX(5px)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV BAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.nav{
  position:fixed;bottom:0;left:0;right:0;
  background:rgba(247,246,243,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-top:1px solid var(--brown-06);
  padding:14px 20px;padding-bottom:calc(32px + env(safe-area-inset-bottom));
  z-index:50;display:none;
}
.nav-inner{max-width:440px;margin:0 auto;display:flex;gap:10px;align-items:center}
.nav-spacer{flex:1}

.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:6px;
  padding:14px 26px;border-radius:var(--rs);
  font-family:'Pretendard Variable',sans-serif;font-size:15px;font-weight:700;
  border:none;cursor:pointer;transition:all .2s ease;white-space:nowrap;
}
.btn:active{transform:scale(.97)}
.btn:disabled{opacity:.3;cursor:not-allowed;transform:none}
.btn svg{width:18px;height:18px;flex-shrink:0}

.btn-primary{background:var(--brown);color:#FFFFFF}
.btn-primary:hover:not(:disabled){background:var(--brown-80)}
.btn-ghost{background:transparent;color:var(--brown-40)}
.btn-ghost:hover{background:var(--brown-04)}

.btn-start{
  width:100%;padding:18px;font-size:16px;margin-top:32px;border-radius:var(--rs);
  background:var(--brown);color:#fff;
}
.btn-start:hover{background:var(--brown-80)}

/* â”€â”€â”€ Toast â”€â”€â”€ */
.toast{
  position:fixed;top:14px;left:50%;
  transform:translateX(-50%) translateY(-44px);
  background:var(--brown);color:#fff;padding:9px 18px;border-radius:12px;
  font-size:13px;font-weight:600;display:flex;align-items:center;gap:7px;
  z-index:200;opacity:0;transition:all .3s cubic-bezier(.16,1,.3,1);pointer-events:none;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast-spin{
  width:12px;height:12px;border:2px solid rgba(255,255,255,.2);border-top-color:#fff;
  border-radius:50%;animation:spin .6s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€â”€ End â”€â”€â”€ */
.end-card{text-align:center;padding:52px 24px;margin-top:40px}
.end-icon{font-size:52px;margin-bottom:20px;display:block}
.end-title{font-size:20px;font-weight:800;margin-bottom:10px;letter-spacing:-0.03em}
.end-desc{font-size:14px;color:var(--brown-80);line-height:1.8}
</style>
</head>
<body>

<div class="prog-wrap"><div class="prog-fill" id="prog"></div></div>

<div class="wrap">

  <!-- â•â•â•â•â•â• INTRO â•â•â•â•â•â• -->
  <div class="step active" id="step-intro" style="text-align:center">
    <div class="intro-tag">âš¡ ì‹œê¸‰ 2ë°° ì±Œë¦°ì§€</div>
    <div class="card intro-card">
      <span class="intro-icon">ğŸ“‹</span>
      <h1 class="intro-title">ì‹œê¸‰ 2ë°° ì±Œë¦°ì§€<br><em>ì°¸ì—¬ì ì„¤ë¬¸ì¡°ì‚¬</em></h1>
      <p class="intro-desc">ì•ˆë…•í•˜ì„¸ìš”! ì‹œê¸‰ 2ë°° ì±Œë¦°ì§€ì—<br>ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br>ì´ ì„¤ë¬¸ì€ ì¿ í° ë°°í¬ ê²½í—˜ê³¼ ì±Œë¦°ì§€ ê°œì„ ì„ ìœ„í•´ ì§„í–‰ë©ë‹ˆë‹¤. ì°¸ì—¬ìë¶„ë“¤ì˜ ì†”ì§í•œ ë‹µë³€ì´ ë” ë‚˜ì€ ì±Œë¦°ì§€ë¥¼ ë§Œë“œëŠ”ë° í° ë„ì›€ì´ ë¼ìš”! ğŸ’ª</p>
      <div class="intro-grid" style="margin-top:0">
        <div class="intro-grid-item"><div class="intro-grid-label">ì˜ˆìƒ ì†Œìš” ì‹œê°„</div><div class="intro-grid-val">1~2ë¶„</div></div>
        <div class="intro-grid-item"><div class="intro-grid-label">ì´ ë¬¸í•­ ìˆ˜</div><div class="intro-grid-val">6~12ê°œ</div></div>
      </div>
      <button class="btn btn-start" style="margin-top:8px" onclick="startSurvey()">ğŸ“ ì„¤ë¬¸ ì‹œì‘í•˜ê¸° <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
    </div>
  </div>

  <!-- â•â•â•â•â•â• PHONE â•â•â•â•â•â• -->
  <div class="step" id="step-phone">
    <div class="card">
      <div class="q-num">ë³¸ì¸ í™•ì¸</div>
      <div class="ph-title">ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”</div>
      <div class="ph-sub">ë³¸ì¸ í™•ì¸ ë° ì¶”í›„ ì±Œë¦°ì§€ ì•ˆë‚´ ìš©ë„ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤</div>
      <div class="ph-gap"></div>
      <div class="ph-row">
        <input class="ph-input" id="ph1" type="tel" maxlength="3" placeholder="010" inputmode="numeric" pattern="[0-9]*">
        <span class="ph-dash">â€”</span>
        <input class="ph-input" id="ph2" type="tel" maxlength="4" placeholder="0000" inputmode="numeric" pattern="[0-9]*">
        <span class="ph-dash">â€”</span>
        <input class="ph-input" id="ph3" type="tel" maxlength="4" placeholder="0000" inputmode="numeric" pattern="[0-9]*">
      </div>
      <div class="val-msg" id="val_phone">âš ï¸ ì—°ë½ì²˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”</div>
    </div>
  </div>

  <!-- â•â•â•â•â•â• QUESTIONS â•â•â•â•â•â• -->
  <div id="qWrap"></div>

  <!-- â•â•â•â•â•â• END â•â•â•â•â•â• -->
  <div class="step" id="step-end">
    <div class="card end-card">
      <span class="end-icon">ğŸ‰</span>
      <h2 class="end-title">ì„¤ë¬¸ì´ ì™„ë£Œë˜ì—ˆì–´ìš”!</h2>
      <p class="end-desc">ì†Œì¤‘í•œ ì‹œê°„ ë‚´ì–´ ë‹µë³€í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br>ì—¬ëŸ¬ë¶„ì˜ ì˜ê²¬ì„ ë°˜ì˜í•˜ì—¬<br>ì±Œë¦°ì§€ë¥¼ ë” ê°œì„ í•˜ê² ìŠµë‹ˆë‹¤!</p>
    </div>
  </div>

</div>

<!-- NAV -->
<div class="nav" id="nav">
  <div class="nav-inner">
    <button class="btn btn-ghost" id="btnPrev" onclick="goPrev()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg> ì´ì „</button>
    <div class="nav-spacer"></div>
    <button class="btn btn-primary" id="btnNext" onclick="goNext()">ë‹¤ìŒ <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
  </div>
</div>

<script>
const APPS_SCRIPT_URL='https://script.google.com/macros/s/AKfycbz30kImvZ63ZOie5xKtktZ5BnhHOlYHYGb848ST0XU13JB3UUWYqwjXke1TDwle6btD/exec';
const sid='S_'+Date.now()+'_'+Math.random().toString(36).substr(2,6);
const answers={};
let curIdx=0,flow=[];
const TOTAL_MAX=14;

// URL íŒŒë¼ë¯¸í„°ì—ì„œ ì•Œë°” ID ì¶”ì¶œ (?alba_id=xxx)
const urlParams=new URLSearchParams(window.location.search);
const albaId=urlParams.get('alba_id')||'';

// í˜ì´ì§€ ì§„ì… ì‹œ ì¦‰ì‹œ ë¡œê·¸
(function(){
  const payload={sessionId:sid,albaId:albaId,questionId:'_PAGE_VIEW',answer:window.location.href,etcText:'',timestamp:new Date().toISOString()};
  try{if(APPS_SCRIPT_URL){fetch(APPS_SCRIPT_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});}}catch(e){}
})();

// â”€â”€ Phone â”€â”€
['ph1','ph2','ph3'].forEach((id,i)=>{
  const el=document.getElementById(id);
  el.addEventListener('input',e=>{
    e.target.value=e.target.value.replace(/\D/g,'');
    const max=i===0?3:4;
    if(e.target.value.length>=max){const nx=['ph1','ph2','ph3'][i+1];if(nx)document.getElementById(nx).focus();}
    upPh();
  });
  el.addEventListener('keydown',e=>{
    if(e.key==='Backspace'&&e.target.value===''&&i>0)document.getElementById(['ph1','ph2','ph3'][i-1]).focus();
  });
});
function upPh(){
  ['ph1','ph2','ph3'].forEach((id,i)=>{const el=document.getElementById(id);const max=i===0?3:4;el.classList.toggle('ok',el.value.length===max);el.classList.remove('bad');});
  document.getElementById('val_phone').classList.remove('show');
}
function valPh(){
  const a=document.getElementById('ph1').value,b=document.getElementById('ph2').value,c=document.getElementById('ph3').value;
  if(a.length===3&&b.length===4&&c.length===4)return a+'-'+b+'-'+c;
  [['ph1',3],['ph2',4],['ph3',4]].forEach(([id,len])=>{if(document.getElementById(id).value.length!==len)document.getElementById(id).classList.add('bad');});
  document.getElementById('val_phone').classList.add('show');return null;
}

// â”€â”€ Questions â”€â”€
const Q={
  Q1:{id:'Q1',num:'Q1',type:'radio',text:'ì‹œê¸‰ 2ë°° ì±Œë¦°ì§€ ì¿ í°(ëª…í•¨í˜•)ì„ ë°›ìœ¼ì…¨ë‚˜ìš”?',options:['ì˜ˆ, ë°›ì•˜ì–´ìš”','ì•„ë‹ˆìš”, ì•„ì§ ëª» ë°›ì•˜ì–´ìš”']},
  'Q1-1':{id:'Q1-1',num:'Q1-1',type:'checkbox',text:'ì¿ í°ì„ ë°›ì§€ ëª»í•œ ì´ìœ ê°€ ë¬´ì—‡ì¸ê°€ìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ë°°ì†¡ì´ ì•„ì§ ì•ˆ ì™”ì–´ìš”','ë°›ì•˜ëŠ”ì§€ ì˜ ëª¨ë¥´ê² ì–´ìš”','ì‚¬ì¥ë‹˜ì´ë‚˜ ë‹¤ë¥¸ ì§ì›ì´ ë°›ì•˜ëŠ”ë° ì €í•œí…Œ ì „ë‹¬ì´ ì•ˆ ëì–´ìš”','ê¸°íƒ€']},
  Q2:{id:'Q2',num:'Q2',type:'radio',text:'ì¿ í°ì´ ë„ì°©í•œ í›„ <span class="hl">[ì¿ í° ë°°ì†¡ ì•ˆë‚´] ì¿ í° ì‚¬ì§„ì„ ì°ì–´ ì œì¶œí•´ì£¼ì„¸ìš”</span> ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ì…¨ì„ í…ë°, í™•ì¸í•˜ì…¨ë‚˜ìš”?',options:['ì˜ˆ, í™•ì¸í–ˆì–´ìš”','ì•„ë‹ˆìš”, ëª» ë´¤ì–´ìš”','ê¸°ì–µì´ ì•ˆ ë‚˜ìš”']},
  'Q2-1':{id:'Q2-1',num:'Q2-1',type:'checkbox',text:'ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì§€ ëª»í•œ ì´ìœ ê°€ ìˆë‚˜ìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ë©”ì‹œì§€ê°€ ì˜¨ ì¤„ ëª°ëì–´ìš”','ì•Œë¦¼ì„ ë´¤ëŠ”ë° ë„˜ê²¼ì–´ìš”','(ê´‘ê³ ) ë¬¸ìë¼ì„œ ì•ˆ ì—´ì–´ë´¤ì–´ìš”','ë°”ë¹ ì„œ ë‚˜ì¤‘ì— ë³´ë ¤ë‹¤ ìŠì—ˆì–´ìš”','ê¸°íƒ€']},
  Q3:{id:'Q3',num:'Q3',type:'radio',text:'ë°›ì€ ì¿ í°ì„ ì†ë‹˜ì—ê²Œ ë‚˜ëˆ ì£¼ê±°ë‚˜,<br>ì†ë‹˜ì´ ê°€ì ¸ê°ˆ ìˆ˜ ìˆê²Œ í•´ë³¸ ì ì´ ìˆë‚˜ìš”?',options:['ì˜ˆ, ìˆì–´ìš”','ì•„ë‹ˆìš”, í•œ ë²ˆë„ ì—†ì–´ìš”']},
  Q4:{id:'Q4',num:'Q4',type:'radio',text:'ì§€ê¸ˆê¹Œì§€ ì¿ í°ì„ ëŒ€ëµ ëª‡ ì¥ ì •ë„ ë‚˜ëˆ ì£¼ì…¨ë‚˜ìš”?',hint:'ì„¸ë³´ì§€ëŠ” ì•Šì•„ë„ ë˜ê³ , ëŒ€ëµì ì¸ ìˆ˜ì¹˜ë¡œ ì„ íƒí•´ì£¼ì„¸ìš”!',options:['20ì¥ ì´í•˜','21~50ì¥','51~100ì¥','101~150ì¥','151ì¥ ì´ìƒ','ì „ë¶€ ë‹¤ ë‚˜ëˆ ì¤¬ì–´ìš” (200ì¥)']},
  Q5:{id:'Q5',num:'Q5',type:'checkbox',text:'ì¿ í°ì„ ì£¼ë¡œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ë‚˜ëˆ ì£¼ì…¨ë‚˜ìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ì†ë‹˜ì—ê²Œ ì§ì ‘ ê±´ë„¤ì¤¬ì–´ìš” (ìŒë£Œ/ìƒí’ˆ ì „ë‹¬ ì‹œ)','ì¹´ìš´í„°ë‚˜ í…Œì´ë¸” ìœ„ì— ë†“ì•„ë’€ì–´ìš” (ì†ë‹˜ì´ ì•Œì•„ì„œ ê°€ì ¸ê°ˆ ìˆ˜ ìˆë„ë¡)','í¬ì¥/í…Œì´í¬ì•„ì›ƒ ì‹œ ì»µí™€ë”ì— ì¿ í°ì„ ë¼ì›Œì„œ ì „ë‹¬í–ˆì–´ìš”','ì˜ìˆ˜ì¦ì´ë‘ ê°™ì´ ì¤¬ì–´ìš”','ê¸°íƒ€']},
  Q6:{id:'Q6',num:'Q6',type:'checkbox',text:'ì£¼ë¡œ ì–¸ì œ ë‚˜ëˆ ì£¼ì…¨ë‚˜ìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ì˜¤í”ˆ ì¤€ë¹„~ì˜¤ì „ 10ì‹œ','ì˜¤ì „ 10ì‹œ~12ì‹œ','ì ì‹¬ì‹œê°„ (12ì‹œ~14ì‹œ)','ì˜¤í›„ 14ì‹œ~17ì‹œ','17ì‹œ ì´í›„ ~ ë§ˆê° ì‹œê°„']},
  Q7:{id:'Q7',num:'Q7',type:'radio',text:'<span class="hl">ì¿ í° ë‚˜ëˆ ì£¼ëŠ” ê¿€íŒì´ ë‹´ê¸´ ë©”ì‹œì§€</span>ë¥¼ ë°›ìœ¼ì…¨ì„ í…ë°, í™•ì¸í•˜ì…¨ë‚˜ìš”?',options:['ì˜ˆ, í™•ì¸í–ˆì–´ìš”','ì•„ë‹ˆìš”, ëª» ë´¤ì–´ìš”','ê¸°ì–µì´ ì•ˆ ë‚˜ìš”']},
  'Q7-1':{id:'Q7-1',num:'Q7-1',type:'checkbox',text:'ê¿€íŒ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì§€ ëª»í•œ ì´ìœ ê°€ ìˆë‚˜ìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ë©”ì‹œì§€ê°€ ì˜¨ ì¤„ ëª°ëì–´ìš”','ì•Œë¦¼ì„ ë´¤ëŠ”ë° ë„˜ê²¼ì–´ìš”','(ê´‘ê³ ) ë¬¸ìë¼ì„œ ì•ˆ ì—´ì–´ë´¤ì–´ìš”','ë°”ë¹ ì„œ ë‚˜ì¤‘ì— ë³´ë ¤ë‹¤ ìŠì—ˆì–´ìš”','ë¹„ìŠ·í•œ ë‚´ìš© ê°™ì•„ì„œ ì•ˆ ì—´ì–´ë´¤ì–´ìš”','ê¸°íƒ€']},
  Q8:{id:'Q8',num:'Q8',type:'checkbox',text:'ì¿ í°ì„ ë‚˜ëˆ ì£¼ë©´ì„œ ì–´ë ¤ì› ê±°ë‚˜ ë¶ˆí¸í–ˆë˜ ì ì´ ìˆë‚˜ìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ì†ë‹˜ì—ê²Œ ì§ì ‘ ë§ ê±¸ê¸°ê°€ ì–´ìƒ‰í–ˆì–´ìš”','ì†ë‹˜ì´ ê´€ì‹¬ ì—†ì–´ í•˜ê±°ë‚˜ ê±°ì ˆí–ˆì–´ìš”','ì¿ í°ì´ ë­”ì§€ ì„¤ëª…í•˜ê¸°ê°€ ì• ë§¤í–ˆì–´ìš”','ì‚¬ì¥ë‹˜ì´ë‚˜ ë§¤ë‹ˆì €ê°€ ë‚˜ëˆ ì£¼ëŠ” ê±¸ ì•ˆ ì¢‹ì•„í–ˆì–´ìš”','íŠ¹ë³„íˆ ì–´ë ¤ìš´ ì ì€ ì—†ì—ˆì–´ìš”','ê¸°íƒ€']},
  Q9:{id:'Q9',num:'Q9',type:'radio',text:'ì¿ í°ì„ í†µí•´ ì†ë‹˜ì´ ì²« ì£¼ë¬¸ì„ í•´ì„œ, ë¦¬ì›Œë“œ(2,000ì›)ë¥¼ ë°›ì€ ì ì´ ìˆë‚˜ìš”?',options:['ì˜ˆ, ë°›ì•˜ì–´ìš”','ì•„ë‹ˆìš”, ì•„ì§ ëª» ë°›ì•˜ì–´ìš”']},
  'Q9-1':{id:'Q9-1',num:'Q9-1',type:'radio',text:'ì•ìœ¼ë¡œë„ ì¿ í°ì„ ê³„ì† ë‚˜ëˆ ì¤„ ìƒê°ì´ ìˆìœ¼ì‹ ê°€ìš”?',options:['ë„¤, ê³„ì† í•  ê±°ì˜ˆìš”','ì¿ í°ì´ ë” ìˆìœ¼ë©´ í•  ê±°ì˜ˆìš” (ë‹¤ ì†Œì§„ë¨)','ì•„ë§ˆ ì•ˆ í•  ê²ƒ ê°™ì•„ìš”']},
  'Q9-2':{id:'Q9-2',num:'Q9-2',type:'checkbox',text:'ê³„ì† í•˜ê³  ì‹¶ì§€ ì•Šì€ ì´ìœ ê°€ ìˆë‹¤ë©´?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ë¦¬ì›Œë“œê°€ ê¸°ëŒ€ë³´ë‹¤ ì ì—ˆì–´ìš”','ë‚˜ëˆ ì£¼ëŠ” ê²Œ ë„ˆë¬´ ë²ˆê±°ë¡œì›Œìš”','ì„±ê³¼ê°€ ì˜ ì•ˆ ë‚˜ì™€ì„œ ë³´ëŒì´ ì—†ì–´ìš”','ê·¼ë¬´ ê¸°ê°„ì´ ëë‚˜ì„œ / ê³§ ê·¸ë§Œë‘˜ ì˜ˆì •ì´ì—ìš”','ê¸°íƒ€']},
  'Q9-3':{id:'Q9-3',num:'Q9-3',type:'checkbox',text:'ì‹œê¸‰ 2ë°° ì±Œë¦°ì§€ë¥¼ ê³„ì† í™œë™í•˜ê¸°ì— ì–´ë–¤ ë¶€ë¶„ì´ ê°œì„ ë˜ë©´ ì¢‹ì„ê¹Œìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ì¿ í° ë””ìì¸ì´ ë” ê¹”ë”í•˜ë©´ ì¢‹ê² ì–´ìš”','ë°›ì„ ìˆ˜ ìˆëŠ” ë¦¬ì›Œë“œê°€ ë” í¬ë©´ ì¢‹ê² ì–´ìš”','ë¦¬ì›Œë“œë¥¼ ìì£¼ ì§€ê¸‰ë°›ì„ ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ì–´ìš”','ë‚´ ì„±ê³¼ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ì–´ìš”','ë‚˜ëˆ ì¤„ ë•Œ ì“¸ ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ ë©˜íŠ¸/ê°€ì´ë“œê°€ ìˆìœ¼ë©´ ì¢‹ê² ì–´ìš”','ê¸°íƒ€']},
  'Q9-4':{id:'Q9-4',num:'Q9-4',type:'checkbox',text:'ì¿ í°ì„ ë‚˜ëˆ ì¤¬ëŠ”ë° ì•„ì§ ë¦¬ì›Œë“œë¥¼ ëª» ë°›ìœ¼ì…¨ëŠ”ë°,<br>ì´ìœ ê°€ ë¬´ì—‡ì´ë¼ê³  ìƒê°í•˜ì‹œë‚˜ìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ì†ë‹˜ì´ ì¿ í°ì„ ë°›ê¸´ í–ˆëŠ”ë° ì£¼ë¬¸ê¹Œì§€ëŠ” ì•ˆ í•œ ê²ƒ ê°™ì•„ìš”','ë‚˜ëˆ ì¤€ ìˆ˜ëŸ‰ì´ ì•„ì§ ë§ì§€ ì•Šì•„ì„œ ê·¸ëŸ° ê²ƒ ê°™ì•„ìš”','ì†ë‹˜ì´ QRì„ ì°ëŠ” ê±¸ ì–´ë ¤ì›Œí•œ ê²ƒ ê°™ì•„ìš”','ì˜ ëª¨ë¥´ê² ì–´ìš”','ê¸°íƒ€']},
  'Q9-5':{id:'Q9-5',num:'Q9-5',type:'radio',text:'ì•ìœ¼ë¡œ ê³„ì† ë‚˜ëˆ ì¤„ ìƒê°ì´ ìˆìœ¼ì‹ ê°€ìš”?',options:['ë„¤, ë” í•´ë³¼ ê±°ì˜ˆìš”','ì„±ê³¼ê°€ ë‚˜ë©´ ê³„ì† í•˜ê² ëŠ”ë°, ì•ˆ ë‚˜ë©´ ê·¸ë§Œë‘˜ ê²ƒ ê°™ì•„ìš”','ì•„ë§ˆ ì•ˆ í•  ê²ƒ ê°™ì•„ìš”']},
  Q10:{id:'Q10',num:'Q10',type:'checkbox',text:'ì¿ í° ë°°í¬ê°€ ë§ì„¤ì—¬ì§€ê±°ë‚˜ ì–´ë ¤ì› ë˜ <span class="hl">ì†”ì§í•œ ì´ìœ </span>ê°€ ë¬´ì—‡ì¸ê°€ìš”?',hint:'í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”',options:['ì†ë‹˜ì—ê²Œ ë¨¼ì € ë§ì„ ê±°ëŠ” ìƒí™© ìì²´ê°€ ë„ˆë¬´ ì–´ìƒ‰í•˜ê³  ë¶€ë‹´ìŠ¤ëŸ¬ì›Œìš”.','ì‚¬ì¥ë‹˜ì´ë‚˜ ë™ë£Œë“¤ì˜ ì‹œì„  ë•Œë¬¸ì— ì ê·¹ì ìœ¼ë¡œ ë‚˜ëˆ ì£¼ê¸° ëˆˆì¹˜ ë³´ì—¬ìš”.','ë¦¬ì›Œë“œ(2,000ì›)ê°€ ì¿ í° ì „ë‹¬ì— ë“œëŠ” ìˆ˜ê³ ì— ë¹„í•´ ì ë‹¤ê³  ëŠê»´ì ¸ìš”.','ì¿ í°ì˜ í˜œíƒì´ë‚˜ ì‚¬ìš©ë²•ì„ ì†ë‹˜ì—ê²Œ ì„¤ëª…í•˜ê¸°ê°€ ë„ˆë¬´ ë³µì¡í•´ìš”.','ì†ë‹˜ì´ ê·€ì°®ì•„í•˜ê±°ë‚˜ ê±°ì ˆí•  ê²ƒ ê°™ì•„ ê±±ì •ë˜ëŠ” ë§ˆìŒì´ ì»¤ìš”.','ê¸°íƒ€']},
  Q11:{id:'Q11',num:'Q11',type:'likert',text:'ì‹œê¸‰ 2ë°° ì±Œë¦°ì§€ í”„ë¡œê·¸ë¨ì— ëŒ€í•´ ì „ë°˜ì ìœ¼ë¡œ ì–´ë–»ê²Œ ëŠë¼ì‹œë‚˜ìš”?',options:[{emoji:'ğŸ˜',label:'ë§¤ìš° ë§Œì¡± (5)'},{emoji:'ğŸ˜Š',label:'ë§Œì¡± (4)'},{emoji:'ğŸ˜',label:'ë³´í†µ (3)'},{emoji:'ğŸ˜•',label:'ë¶ˆë§Œì¡± (2)'},{emoji:'ğŸ˜',label:'ë§¤ìš° ë¶ˆë§Œì¡± (1)'}]},
  Q12:{id:'Q12',num:'Q12',type:'freetext',text:'í”„ë¡œê·¸ë¨ì— ëŒ€í•´ í•˜ê³  ì‹¶ì€ ë§ì´ ìˆë‹¤ë©´ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”!',hint:'ì„ íƒì‚¬í•­ì´ì—ìš”. ê±´ë„ˆë›°ì–´ë„ ê´œì°®ì•„ìš”!',optional:true}
};

// â”€â”€ Flow â”€â”€
function buildFlow(){
  const f=['_phone','Q1'];
  // Q1: ì¿ í° ìˆ˜ë ¹ ì—¬ë¶€
  if(answers['Q1']==='ì•„ë‹ˆìš”, ì•„ì§ ëª» ë°›ì•˜ì–´ìš”'){
    f.push('Q1-1');
    // ë¯¸ìˆ˜ë ¹ìëŠ” ì—¬ê¸°ì„œ ì„¤ë¬¸ ì¢…ë£Œ
    return f;
  }
  // Q1 â†’ ì˜ˆ: Q2ë¡œ
  f.push('Q2');
  if(answers['Q2']==='ì•„ë‹ˆìš”, ëª» ë´¤ì–´ìš”'||answers['Q2']==='ê¸°ì–µì´ ì•ˆ ë‚˜ìš”') f.push('Q2-1');
  f.push('Q3');

  if(answers['Q3']==='ì˜ˆ, ìˆì–´ìš”'){
    // ë°°í¬ ê²½í—˜ì ë£¨íŠ¸
    f.push('Q4','Q5','Q6','Q7');
    if(answers['Q7']==='ì•„ë‹ˆìš”, ëª» ë´¤ì–´ìš”'||answers['Q7']==='ê¸°ì–µì´ ì•ˆ ë‚˜ìš”') f.push('Q7-1');
    f.push('Q8','Q9');
    if(answers['Q9']==='ì˜ˆ, ë°›ì•˜ì–´ìš”'){
      // ì„±ê³¼ ì•Œë°” ë£¨íŠ¸
      f.push('Q9-1');
      if(answers['Q9-1']==='ì•„ë§ˆ ì•ˆ í•  ê²ƒ ê°™ì•„ìš”') f.push('Q9-2');
      f.push('Q9-3');
    } else if(answers['Q9']==='ì•„ë‹ˆìš”, ì•„ì§ ëª» ë°›ì•˜ì–´ìš”'){
      // í™œë™O ì„±ê³¼X ë£¨íŠ¸
      f.push('Q9-4','Q9-5');
    }
    // ê³µí†µ ë§ˆë¬´ë¦¬
    f.push('Q11','Q12');
  } else if(answers['Q3']==='ì•„ë‹ˆìš”, í•œ ë²ˆë„ ì—†ì–´ìš”'){
    // ë¯¸ë°°í¬ì ë£¨íŠ¸
    f.push('Q10');
    // ê³µí†µ ë§ˆë¬´ë¦¬
    f.push('Q11','Q12');
  }

  return f;
}

// â”€â”€ Render â”€â”€
function renderQ(qd){
  const w=document.getElementById('qWrap');w.innerHTML='';
  const d=document.createElement('div');d.className='step active';
  let h=`<div class="card"><div class="q-num">${qd.num}</div><div class="q-text">${qd.text}</div>`;
  if(qd.hint)h+=`<div class="q-hint">${qd.hint}</div>`;
  if(qd.type==='checkbox')h+=`<div class="q-multi">ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥</div>`;
  h+=`<div class="q-gap"></div>`;
  if(qd.type==='checkbox'){
    h+=`<div class="opts">`;
    qd.options.forEach((o,i)=>{const isE=o==='ê¸°íƒ€';
      h+=`<div class="opt"><input type="checkbox" name="${qd.id}" id="${qd.id}_${i}" value="${o}" ${isE?'data-etc="1"':''} onchange="onChg('${qd.id}')"><label class="opt-label" for="${qd.id}_${i}"><span class="ind chk"></span>${o}</label></div>`;
      if(isE)h+=`<div class="etc-wrap" id="${qd.id}_ew"><textarea class="etc-ta" id="${qd.id}_et" placeholder="ì§ì ‘ ì…ë ¥í•´ ì£¼ì„¸ìš”..." oninput="onChg('${qd.id}')"></textarea></div>`;
    });h+=`</div>`;
  }else if(qd.type==='radio'){
    h+=`<div class="opts">`;
    qd.options.forEach((o,i)=>{h+=`<div class="opt"><input type="radio" name="${qd.id}" id="${qd.id}_${i}" value="${o}" onchange="onChg('${qd.id}')"><label class="opt-label" for="${qd.id}_${i}"><span class="ind"></span>${o}</label></div>`;});
    h+=`</div>`;
  }else if(qd.type==='likert'){
    h+=`<div class="likert">`;
    qd.options.forEach((o,i)=>{h+=`<div class="lik"><input type="radio" name="${qd.id}" id="${qd.id}_${i}" value="${o.label}" onchange="onChg('${qd.id}')"><label class="lik-label" for="${qd.id}_${i}"><span class="lik-emoji">${o.emoji}</span>${o.label}</label></div>`;});
    h+=`</div>`;
  }else if(qd.type==='freetext'){
    h+=`<textarea class="free-ta" id="${qd.id}_t" placeholder="ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”..." oninput="onChg('${qd.id}')"></textarea>`;
  }
  h+=`<div class="val-msg" id="val_${qd.id}">âš ï¸ ë‹µë³€ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</div></div>`;
  d.innerHTML=h;w.appendChild(d);restoreAns(qd);
}
function restoreAns(qd){
  const a=answers[qd.id];if(!a)return;
  if(qd.type==='radio'||qd.type==='likert'){document.querySelectorAll(`input[name="${qd.id}"]`).forEach(r=>{if(r.value===a)r.checked=true});}
  else if(qd.type==='checkbox'){const v=Array.isArray(a)?a:[a];document.querySelectorAll(`input[name="${qd.id}"]`).forEach(c=>{if(v.includes(c.value)){c.checked=true;if(c.dataset.etc){const w=document.getElementById(qd.id+'_ew');if(w)w.classList.add('show');const t=document.getElementById(qd.id+'_et');if(t&&answers[qd.id+'_etc'])t.value=answers[qd.id+'_etc'];}}});}
  else if(qd.type==='freetext'){const t=document.getElementById(qd.id+'_t');if(t&&a)t.value=a;}
}
function onChg(qId){
  const qd=Q[qId];
  if(qd.type==='checkbox'){const ec=document.querySelector(`input[name="${qId}"][data-etc="1"]`);if(ec){const w=document.getElementById(qId+'_ew');if(ec.checked)w.classList.add('show');else w.classList.remove('show');}}
  document.getElementById('val_'+qId).classList.remove('show');
}
function getAns(qId){
  const qd=Q[qId];
  if(qd.type==='radio'||qd.type==='likert'){const c=document.querySelector(`input[name="${qId}"]:checked`);return c?c.value:null;}
  if(qd.type==='checkbox'){const cs=document.querySelectorAll(`input[name="${qId}"]:checked`);const v=Array.from(cs).map(c=>c.value);const ec=document.querySelector(`input[name="${qId}"][data-etc="1"]`);if(ec&&ec.checked){const t=document.getElementById(qId+'_et');if(t)answers[qId+'_etc']=t.value;}return v.length?v:null;}
  if(qd.type==='freetext'){const t=document.getElementById(qId+'_t');return t?t.value:null;}
  return null;
}
function valQ(qId){
  const qd=Q[qId];if(qd.optional)return true;
  const a=getAns(qId);if(!a||(Array.isArray(a)&&!a.length)){document.getElementById('val_'+qId).classList.add('show');return false;}
  if(qd.type==='checkbox'&&Array.isArray(a)&&a.includes('ê¸°íƒ€')){const t=document.getElementById(qId+'_et');if(t&&!t.value.trim()){document.getElementById('val_'+qId).innerHTML='âš ï¸ ê¸°íƒ€ í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”';document.getElementById('val_'+qId).classList.add('show');return false;}}
  return true;
}

// â”€â”€ Save â”€â”€
async function saveData(qId,answer){
  const payload={sessionId:sid,albaId:albaId,questionId:qId,answer:Array.isArray(answer)?answer.join(', '):(answer||''),etcText:answers[qId+'_etc']||'',timestamp:new Date().toISOString()};
  try{if(APPS_SCRIPT_URL){fetch(APPS_SCRIPT_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});}}catch(e){}
}

// â”€â”€ Progress â”€â”€
function updateProg(){document.getElementById('prog').style.width=Math.min(((curIdx+1)/TOTAL_MAX)*100,100)+'%';}

// â”€â”€ Nav â”€â”€
function startSurvey(){
  hide('step-intro');show('step-phone');document.getElementById('nav').style.display='block';
  flow=buildFlow();curIdx=0;document.getElementById('btnPrev').style.visibility='hidden';
  updateProg();updateBtn();saveData('_SESSION_START',new Date().toISOString());
  setTimeout(()=>document.getElementById('ph1').focus(),400);
}
function showStep(){
  const id=flow[curIdx];hide('step-intro');hide('step-end');hide('step-phone');
  document.getElementById('nav').style.display='block';
  if(id==='_phone'){show('step-phone');document.getElementById('qWrap').innerHTML='';setTimeout(()=>document.getElementById('ph1').focus(),300);}
  else{renderQ(Q[id]);}
  document.getElementById('btnPrev').style.visibility=curIdx===0?'hidden':'visible';
  updateProg();updateBtn();window.scrollTo({top:0,behavior:'smooth'});
}
function updateBtn(){
  const btn=document.getElementById('btnNext'),isLast=curIdx===flow.length-1;
  btn.innerHTML=isLast?`ì œì¶œ ì™„ë£Œ <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>`:`ë‹¤ìŒ <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>`;
}
function goNext(){
  const id=flow[curIdx];
  if(id==='_phone'){const phone=valPh();if(!phone)return;answers['_phone']=phone;saveData('phone',phone);flow=buildFlow();curIdx=flow.indexOf('_phone')+1;showStep();return;}
  if(!valQ(id))return;const a=getAns(id);answers[id]=a;saveData(id,a);
  flow=buildFlow();const qi=flow.indexOf(id);if(qi===flow.length-1){showEnd();return;}curIdx=qi+1;showStep();
}
function goPrev(){if(curIdx<=0)return;curIdx--;showStep();}
function showEnd(){
  document.getElementById('qWrap').innerHTML='';hide('step-phone');show('step-end');
  document.getElementById('nav').style.display='none';document.getElementById('prog').style.width='100%';
  saveData('_SESSION_END',new Date().toISOString());window.scrollTo({top:0,behavior:'smooth'});
}
function hide(id){document.getElementById(id).classList.remove('active')}
function show(id){document.getElementById(id).classList.add('active')}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){if(document.activeElement&&document.activeElement.tagName==='TEXTAREA')return;if(document.getElementById('nav').style.display!=='none'){e.preventDefault();goNext();}}});
</script>
</body>
</html>
